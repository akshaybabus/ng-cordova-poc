pipeline {
   agent any
      environment {
         PATH='/usr/local/bin:/usr/bin:/bin'
      }
   stages {
    stage('Jasmine testing') {
      steps {
        dir('angular')
        {
            sh 'ng test --watch=false'
        }
        
      }
    }
    
    stage('Protractor testing') {
      steps {
        dir('angular')
        {
            sh 'ng e2e'
        }
        
      }
    }
    
    stage('Build Angular to Cordova dir') {
      steps {
        dir('angular')
        {
            sh 'ls -l'        
            sh 'npm install'
            sh 'ng build -op ../cordova/www/'
        }
        
      }
    }
    
    stage('Build Android app') {
      steps {
        dir('cordova')
        {
            sh 'if [ ! -d "platforms/android" ]; then cordova platform add android; fi'
            sh 'cordova build android'
        }
        
      }
   }
   stage('Publish Android App to Hockey'){
       steps{
           hockeyApp applications: [
  [
    apiToken: '629275da84e340079c6480a606407eba',
    downloadAllowed: true,
    filePath: 'cordova/platforms/android/build/outputs/apk/android-debug.apk',
    releaseNotesMethod: manual(isMarkdown: true, releaseNotes: 'Bug fixes and minor updates'),
    uploadMethod: appCreation(false)
  ]
], debugMode: false, failGracefully: false,baseUrlHolder: [baseUrl: 'https://rink.hockeyapp.net']

slackSend channel: '#general', color: 'Green', message: 'Build Successful', token: '5Q8vdCLU3zQquivD26pIqTal'
       }
   }
   
   stage('Build iOS app') {
      steps {
        dir('cordova')
        {
            sh 'if [ ! -d "platforms/ios" ]; then cordova platform add ios; fi'
            sh 'cordova build ios'
        }
        
      }
   }
      stage('Sending Notification'){
       steps{
         slackSend channel: '#general', color: 'Green', message: 'Build Successful for IOS & Android', token: '5Q8vdCLU3zQquivD26pIqTal'
       }
   }
   }
}
